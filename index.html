<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zoho Power Dialer</title>
    <script src="https://live.zwidgets.com/js-sdk/1.1/ZohoEmbededAppSDK.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f6f8; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-bar { padding: 10px; background: #e3f2fd; border-radius: 4px; margin-bottom: 20px; font-weight: bold; color: #1565c0; text-align: center;}
        .lead-card { border: 1px solid #ddd; padding: 15px; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .lead-card.active { border-color: #2196f3; background-color: #f0f8ff; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #4caf50; color: white; }
        .btn-red { background: #f44336; color: white; }
        .controls { text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>âš¡ Power Dialer</h2>
    <div id="status-display" class="status-bar">Ready to initialize...</div>

    <div id="leads-container">
        </div>

    <div class="controls">
        <button id="start-btn" class="btn btn-green" onclick="startPowerDialer()">Start Session</button>
        <button id="stop-btn" class="btn btn-red" onclick="stopSession()" style="display:none;">Stop</button>
    </div>
</div>

<script>
    /* =========================================
       1. CONFIGURATION & STATE
       ========================================= */
    let currentLeadIndex = 0;
    let isSessionActive = false;
    
    // MOCK DATA: In the next step, we will fetch this from Zoho using ZOHO.CRM.API.getAllRecords
    const leads = [
        { id: '101', Name: 'Bartow Construction', Phone: '555-0101' },
        { id: '102', Name: 'Cartersville Logistics', Phone: '555-0102' },
        { id: '103', Name: 'Acworth Supplies', Phone: '555-0103' }
    ];

    /* =========================================
       2. ZOHO WIDGET INITIALIZATION
       ========================================= */
    ZOHO.embeddedApp.on("PageLoad", function(data) {
        // This triggers when the widget loads inside Zoho
        console.log("Zoho Widget Loaded:", data);
        document.getElementById('status-display').innerText = "Connected to Zoho. Ready to Dial.";
        renderLeads();
    });

    ZOHO.embeddedApp.init();

    /* =========================================
       3. RINGLOGIX / NETSAPIENS VOICE LOGIC
       ========================================= */
    
    // TODO: Initialize your RingLogix SDK here
    // const voiceClient = new NetSapiensUI({ ...credentials... });

    async function placeCall(phoneNumber) {
        console.log(`[RingLogix] Initiating call to ${phoneNumber}...`);
        document.getElementById('status-display').innerText = `Dialing ${phoneNumber}...`;

        // --- REAL VOICE LOGIC GOES HERE ---
        // Example: await voiceClient.call(phoneNumber);
        // For now, we simulate a 3-second call setup
        return new Promise(resolve => {
            setTimeout(() => {
                console.log(`[RingLogix] Call connected to ${phoneNumber}`);
                resolve(true);
            }, 3000);
        });
    }

    /* =========================================
       4. POWER DIALER LOGIC
       ========================================= */
    
    function renderLeads() {
        const container = document.getElementById('leads-container');
        container.innerHTML = leads.map((lead, index) => `
            <div class="lead-card ${index === currentLeadIndex ? 'active' : ''}" id="card-${index}">
                <div>
                    <strong>${lead.Name}</strong><br>
                    <small>${lead.Phone}</small>
                </div>
                <div id="status-${index}">Wait</div>
            </div>
        `).join('');
    }

    async function startPowerDialer() {
        isSessionActive = true;
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('stop-btn').style.display = 'inline-block';

        for (let i = 0; i < leads.length; i++) {
            if (!isSessionActive) break;

            currentLeadIndex = i;
            renderLeads(); // Update UI to show active card
            
            const lead = leads[i];
            document.getElementById(`status-${i}`).innerText = "ðŸ“ž Dialing...";
            
            // TRIGGER THE CALL
            await placeCall(lead.Phone);
            
            // SIMULATE "ON CALL" (In reality, you'd wait for the 'Call Ended' event from RingLogix)
            document.getElementById(`status-${i}`).innerText = "ðŸ—£ï¸ Connected";
            await new Promise(r => setTimeout(r, 4000)); // Fake conversation time

            document.getElementById(`status-${i}`).innerText = "âœ… Done";
        }

        document.getElementById('status-display').innerText = "Session Complete.";
        stopSession();
    }

    function stopSession() {
        isSessionActive = false;
        document.getElementById('start-btn').style.display = 'inline-block';
        document.getElementById('stop-btn').style.display = 'none';
    }

</script>
</body>
</html>
